{% extends 'navbar.html' %}
{% block head %}
{{super()}}
<link href="{{url_for('static',filename='css/bootstrap-editable.css')}}" rel="stylesheet">
<link href="{{url_for('static',filename='css/bootstrap-table.min.css')}}" rel="stylesheet">
{% endblock %}
{% block wrappercontent%}
<div class="row">
 <div class="form-inline">
        <div class="form-group">
            <label for="queryChannelText">支付产品码：</label>
            <input id="queryChannelText" class="form-control input-sm">
        </div>
        <div class="form-group">
            <label for="queryProductText">业务产品码：</label>
            <input id="queryProductText" class="form-control input-sm">
        </div>
        <button class="btn btn-primary btn-sm" id="queryBtn">查询</button>
        <button class="btn btn-primary btn-sm" id="resetBtn">重置</button>
        <button class="btn btn-primary btn-sm" id="addBtn">新增</button>
    </div>
    <br/>
    <table id="dimTable"></table>
    <!-- 新增模态窗 -->
        <div class="modal fade" id="addModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">×</button>
                        <h4 class="modal-title">新增</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="addCatagoryv1Text">收款/付款：</label>
                                <input id="addCatagoryv1Text" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="addCatagoryv2Text">产品大类：</label>
                                <input id="addCatagoryv2Text" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="addCatagoryv3Text">签约产品大类：</label>
                                <input id="addCatagoryv3Text" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="addCatagoryv4Text">支付方式分类：</label>
                                <input id="addCatagoryv4Text" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="addCatagoryv5Text">业务统计分类：</label>
                                <input id="addCatagoryv5Text" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="addCatagoryv6Text">签约产品：</label>
                                <input id="addCatagoryv6Text" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="addChannelCodeText">支付产品码：</label>
                                <input id="addChannelCodeText" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="addChannelNameText">支付产品名称：</label>
                                <input id="addChannelNameText" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="addProductCodeText">业务产品码：</label>
                                <input id="addProductCodeText" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="addProductNameText">业务产品名称：</label>
                                <input id="addProductNameText" class="form-control input-sm">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" data-dismiss="modal">关闭</button>
                        <button class="btn btn-primary" id="saveAdd">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 修改模态窗 -->
        <div class="modal fade" id="modifyModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">×</button>
                        <h4 class="modal-title">修改</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="modifyCatagoryv1Text">收款/付款：</label>
                                <input id="modifyCatagoryv1Text" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="modifyCatagoryv2Text">产品大类：</label>
                                <input id="modifyCatagoryv2Text" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="modifyCatagoryv3Text">签约产品大类：</label>
                                <input id="modifyCatagoryv3Text" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="modifyCatagoryv4Text">支付方式分类：</label>
                                <input id="modifyCatagoryv4Text" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="modifyCatagoryv5Text">业务统计分类：</label>
                                <input id="modifyCatagoryv5Text" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="modifyCatagoryv6Text">签约产品：</label>
                                <input id="modifyCatagoryv6Text" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="modifyChannelCodeText">支付产品码：</label>
                                <input id="modifyChannelCodeText" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="modifyChannelNameText">支付产品名称：</label>
                                <input id="modifyChannelNameText" class="form-control input-sm">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="modifyProductCodeText">业务产品码：</label>
                                <input id="modifyProductCodeText" class="form-control input-sm">
                            </div>
                            <div class="form-group">
                                <label for="modifyProductNameText">业务产品名称：</label>
                                <input id="modifyProductNameText" class="form-control input-sm">
                            </div>
                        </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" data-dismiss="modal">关闭</button>
                        <button class="btn btn-primary" id="saveModify">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js%}
<script src="{{url_for('static',filename='js/tableExport.min.js')}}"></script>
<script src="{{url_for('static',filename='js/bootstrap-table.min.js')}}"></script>
<script src="{{url_for('static',filename='js/bootstrap-table-export.min.js')}}"></script>
<script src="{{url_for('static',filename='js/bootstrap-table-zh-CN.js')}}"></script>
<script src="{{url_for('static',filename='js/bootbox.min.js')}}"></script>
<script>
        var $dimTable = $('#dimTable');
        var tablename = 'DimLkpProductCatagory';
        $dimTable.bootstrapTable({
        url: '/dims/getData/dim_lkp_product_catagory',
        queryParams: function (params) {
            return {
                tablename: tablename,
                offset: params.offset,
                limit: params.limit,
                channelcode: $('#queryChannelText').val(),
                productcode: $('#queryProductText').val()
            }
        },
        columns: [
        {
            field: 'id',
            title: 'ID'
        },
            {
            field: 'catagory_v1',
            title: '收款/付款'
        }, {
            field: 'catagory_v2',
            title: '产品大类'
        }, {
            field: 'catagory_v3',
            title: '签约产品大类'
        }, {
            field: 'catagory_v4',
            title: '支付方式分类'
        }, {
            field: 'catagory_v5',
            title: '业务统计分类'
        }, {
            field: 'catagory_v6',
            title: '签约产品'
        }, {
            field: 'pay_channel_code',
            title: '支付产品码'
        }, {
            field: 'pay_channel_name',
            title: '支付产品名称'
        }, {
            field: 'biz_prod_code',
            title: '业务产品码'
        }, {
            field: 'biz_prod_name',
            title: '业务产品名称'
        }, {
            formatter: function (value, row, index) {
                return [
                    '<a href="javascript:modifyDim(' + row.id + ",'" + row.catagory_v1 + "','" + row.catagory_v2
                    + "','" + row.catagory_v3 + "','" + row.catagory_v4 + "','"  + row.catagory_v5 + "','"
                     + row.catagory_v6 + "','" + row.pay_channel_code + "','" + row.pay_channel_name + "','" +
                     row.biz_prod_code + "','"+ row.biz_prod_name + "'" + ')">' +
                        '<button class="btn btn-primary btn-sm" id="modBtn">修改</button>' +
                    '</a>',
                    '   <a href="javascript:delDim(' + row.id + ')">' +
                        '<button class="btn btn-primary btn-sm" id="delBtn">删除</button>' +
                    '</a>'
                ].join('');
            },
            title: '操作'
        }],
        striped: true,
        pagination: true,
        sidePagination: 'server',
        pageSize: 10,
        pageList: [5, 10, 25, 50, 100],
    });

    bootbox.setLocale('zh_CN');

    var titleTip = '提示';

    // 验证姓名和地址是否为空
    function verifyNewData(catagory_v1, catagory_v2, pay_channel_code, pay_channel_name, biz_prod_code,
    biz_prod_name) {
        if (catagory_v1 != '' && catagory_v2 != '' && pay_channel_code != '' && pay_channel_name != '' &&
        biz_prod_code != '' && biz_prod_name != '') {
            return true;
        }
        return false;
    }

    function nullAlert() {
        bootbox.alert({
            title: titleTip,
            message: '收款/付款、产品大类、支付码、支付产品、产品码、业务产品为必填！'
        });
    }

    $('#queryBtn').click(function () {

        $dimTable.bootstrapTable('selectPage', 1);
    });

    // 点击重置按钮，清空查询条件并跳转回第一页
    $('#resetBtn').click(function() {
        $('.form-group :text').val('');
        $dimTable.bootstrapTable('selectPage', 1);
    });

    // 用于修改服务器资源
    function exchangeData(path, tablename, id, catagory_v1, catagory_v2, catagory_v3, catagory_v4, catagory_v5, catagory_v6,
    pay_channel_code, pay_channel_name, biz_prod_code, biz_prod_name) {
        $.ajax({
            url: path,
            type: 'post',
            data : {
                tablename:tablename,
                id:id,
                exchange_data : JSON.stringify({
                    catagory_v1:catagory_v1,
                    catagory_v2:catagory_v2,
                    catagory_v3:catagory_v3,
                    catagory_v4:catagory_v4,
                    catagory_v5:catagory_v5,
                    catagory_v6:catagory_v6,
                    pay_channel_code:pay_channel_code,
                    pay_channel_name:pay_channel_name,
                    biz_prod_code:biz_prod_code,
                    biz_prod_name:biz_prod_name
                })
            },
            success: function(res) {
                bootbox.alert({
                    title: titleTip,
                    message: res.message
                });
                // 在每次提交操作后返回首页
                $dimTable.bootstrapTable('selectPage', 1);
            }
        });
    }

    // 新增
    $('#addBtn').click(function() {
        $('#addCatagoryv1Text').val('');
        $('#addCatagoryv2Text').val('');
        $('#addCatagoryv3Text').val('');
        $('#addCatagoryv4Text').val('');
        $('#addCatagoryv5Text').val('');
        $('#addCatagoryv6Text').val('');
        $('#addChannelCodeText').val('');
        $('#addChannelNameText').val('');
        $('#addProductCodeText').val('');
        $('#addProductNameText').val('');
        $('#addModal').modal('show');
    });

    $('#saveAdd').click(function() {
        $('#addModal').modal('hide');
        bootbox.confirm({
            title: titleTip,
            message: '确认增加？',
            callback: function (flag) {
                if (flag) {
                    var catagory_v1 = $('#addCatagoryv1Text').val();
                    var catagory_v2 = $('#addCatagoryv2Text').val();
                    var catagory_v3 = $('#addCatagoryv3Text').val();
                    var catagory_v4 = $('#addCatagoryv4Text').val();
                    var catagory_v5 = $('#addCatagoryv5Text').val();
                    var catagory_v6 = $('#addCatagoryv6Text').val();
                    var pay_channel_code = $('#addChannelCodeText').val();
                    var pay_channel_name = $('#addChannelNameText').val();
                    var biz_prod_code = $('#addProductCodeText').val();
                    var biz_prod_name = $('#addProductNameText').val();
                    if (verifyNewData(catagory_v1, catagory_v2, pay_channel_code, pay_channel_name, biz_prod_code,
                    biz_prod_name)) {
                        exchangeData('/dims/add', tablename, '',catagory_v1, catagory_v2, catagory_v3, catagory_v4, catagory_v5,
                        catagory_v6, pay_channel_code, pay_channel_name, biz_prod_code, biz_prod_name);
                    } else {
                        nullAlert();
                    }
                }
            }
        });
    });

    var mid;
    // 修改
    function modifyDim(id,catagory_v1, catagory_v2, catagory_v3, catagory_v4, catagory_v5,
    catagory_v6, pay_channel_code, pay_channel_name, biz_prod_code, biz_prod_name) {
        mid = id;
        $('#modifyCatagoryv1Text').val(catagory_v1);
        $('#modifyCatagoryv2Text').val(catagory_v2);
        $('#modifyCatagoryv3Text').val(catagory_v3);
        $('#modifyCatagoryv4Text').val(catagory_v4);
        $('#modifyCatagoryv5Text').val(catagory_v5);
        $('#modifyCatagoryv6Text').val(catagory_v6);
        $('#modifyChannelCodeText').val(pay_channel_code);
        $('#modifyChannelNameText').val(pay_channel_name);
        $('#modifyProductCodeText').val(biz_prod_code);
        $('#modifyProductNameText').val(biz_prod_name);
        $('#modifyModal').modal('show');
    }

    $('#saveModify').click(function() {
        $('#modifyModal').modal('hide');
        bootbox.confirm({
            title: titleTip,
            message: '确认修改？',
            callback: function (flag) {
                if (flag) {
                    var catagory_v1 = $('#modifyCatagoryv1Text').val();
                    var catagory_v2 = $('#modifyCatagoryv2Text').val();
                    var catagory_v3 = $('#modifyCatagoryv3Text').val();
                    var catagory_v4 = $('#modifyCatagoryv4Text').val();
                    var catagory_v5 = $('#modifyCatagoryv5Text').val();
                    var catagory_v6 = $('#modifyCatagoryv6Text').val();
                    var pay_channel_code = $('#modifyChannelCodeText').val();
                    var pay_channel_name = $('#modifyChannelNameText').val();
                    var biz_prod_code = $('#modifyProductCodeText').val();
                    var biz_prod_name = $('#modifyProductNameText').val();
                    if (verifyNewData(catagory_v1, catagory_v2, pay_channel_code, pay_channel_name, biz_prod_code,
                    biz_prod_name)) {
                        exchangeData('/dims/edit', tablename, mid, catagory_v1, catagory_v2, catagory_v3, catagory_v4, catagory_v5,
                        catagory_v6, pay_channel_code, pay_channel_name, biz_prod_code, biz_prod_name);
                    } else {
                        nullAlert();
                    }
                }
            }
        });
    });

    // 删除
    function delDim(id) {
        bootbox.confirm({
            title: titleTip,
            message: '确认删除？',
            callback: function(flag) {
                if (flag) {
                    exchangeData("/dims/delete", tablename, id);
                }
            }
        });

    }
</script>
{% endblock %}